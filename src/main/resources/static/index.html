<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸–å­åˆ—è¡¨</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f5;
            padding: 15px;
            line-height: 1.6;
            min-height: 100vh;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { 
            text-align: center; 
            margin-bottom: 15px; 
            color: #333;
            font-size: 24px;
        }

        .search-box {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        .search-box input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            -webkit-appearance: none;
            background: white;
        }
        .search-box input:focus {
            outline: none;
            border-color: #007bff;
        }
        .search-box button {
            padding: 12px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            white-space: nowrap;
            -webkit-appearance: none;
        }
        .search-box button:active { background: #0056b3; }

        .post-list { list-style: none; }
        .post-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        .post-item a {
            text-decoration: none;
            color: #333;
            display: block;
        }
        .post-item a:active { opacity: 0.7; }
        .post-content {
            font-size: 15px;
            color: #444;
            white-space: pre-wrap;
            word-break: break-word;
            line-height: 1.6;
        }
        .post-date {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .no-results {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            body { padding: 10px; }
            h1 { font-size: 20px; }
            .search-box input { font-size: 14px; padding: 10px 12px; }
            .search-box button { font-size: 14px; padding: 10px 16px; }
            .post-content { font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“‹ å¸–å­åˆ—è¡¨</h1>
        
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="æœç´¢å†…å®¹..." />
            <button onclick="search()">æœç´¢</button>
        </div>
        
        <div id="postList">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script>
        let allPosts = [];
        let commentsData = {};

        async function loadData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                const data = await response.json();
                allPosts = data.posts || [];
                commentsData = data.comments || {};
                console.log('åŠ è½½æˆåŠŸï¼Œå¸–å­æ•°ï¼š' + allPosts.length);
                renderPosts(allPosts);
            } catch (e) {
                console.error('åŠ è½½å¤±è´¥:', e);
                document.getElementById('postList').innerHTML =
                    '<div class="no-results">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•<br/><small>' + e.message + '</small></div>';
            }
        }

        function renderPosts(posts) {
            const container = document.getElementById('postList');

            if (!posts || posts.length === 0) {
                container.innerHTML = '<div class="no-results">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å¸–å­</div>';
                return;
            }

            container.innerHTML = '<ul class="post-list">' +
                posts.map(post => {
                    const commentCount = (commentsData[post.id] || []).length;
                    return `
                    <li class="post-item">
                        <a href="post.html?id=${post.id}">
                            <div class="post-content">${escapeHtml(abbreviate(post.content, 120))}</div>
                            <div class="post-date">${formatDate(post.createdAt)} Â· ${commentCount}æ¡è¯„è®º</div>
                        </a>
                    </li>
                `}).join('') +
                '</ul>';
        }

        function search() {
            const input = document.getElementById('searchInput');
            const kw = (input.value || '').trim();
            
            // ç©ºæœç´¢æ˜¾ç¤ºå…¨éƒ¨
            if (!kw) {
                renderPosts(allPosts);
                return;
            }
            
            // ä½¿ç”¨æ›´å…¼å®¹çš„æœç´¢æ–¹å¼
            const searchLower = kw.toLowerCase();
            const filtered = allPosts.filter(post => {
                const content = post.content || '';
                return content.toLowerCase().indexOf(searchLower) !== -1;
            });
            
            console.log('æœç´¢å…³é”®è¯ï¼š"'+kw+'", ç»“æœï¼š'+filtered.length+'æ¡');
            renderPosts(filtered);
        }

        // æ”¯æŒå›è½¦æœç´¢
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    search();
                }
            });
        }

        function abbreviate(str, len) {
            if (!str) return '';
            return str.length > len ? str.substring(0, len) + '...' : str;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            try {
                const date = new Date(dateStr);
                return date.toLocaleString('zh-CN');
            } catch (e) {
                return dateStr;
            }
        }

        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½æ•°æ®
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadData);
        } else {
            loadData();
        }
    </script>
</body>
</html>
